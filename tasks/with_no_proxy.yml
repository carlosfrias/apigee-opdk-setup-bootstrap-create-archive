---
# tasks file for apigee-opdk-setup-local-repository
- name: Install the local mirror with no proxy
  shell: "{{ apigee_service }} apigee-mirror install"
  args:
    creates: "{{ apigee_installation_home }}/apigee-mirror/lib/actions/nginxconfig"

- name: Clear the local mirror data directory with no proxy
  shell: "{{ apigee_service }} apigee-mirror clean"

- name: Sync the local mirror with only new rpms with no proxy
  shell: "{{ apigee_service }} apigee-mirror sync --only-new-rpms apigeereleasever={{ apigee_mirror_version }}"
  when: all_rpms is not defined and not all_rpms | bool == True

- name: Sync the local mirror with all rpms with no proxy
  shell: "{{ apigee_service }} apigee-mirror sync apigeereleasever={{ apigee_mirror_version }}"
  when: all_rpms is defined and all_rpms | bool == True

- name: Create archive with no proxy
  shell: "{{ apigee_service }} apigee-mirror package"
